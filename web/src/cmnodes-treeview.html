<!-- Import Polymer -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">
<link rel="import" href="../bower_components/core-item/core-item.html">

<polymer-element name="cmnodes-treeview" attributes="data-src">
    <template>
        <style>
            core-item.expanded:before{
                content: '- ';
            }
            core-item.collapsed:before{
                content: '+ ';
            }
            core-item {
                cursor: pointer;
            }
        </style>
        <div id="main" unresolved="">
            <template id="tree_template" bind="{{data}}">
             <core-menu>
                     <core-item icon="settings" label="{{ name }}"
                        class="{{ {collapsed: !cv, expanded: cv} | tokenList }}" 
                        on-tap="{{toggleChildren}}">
                     </core-item>
                    <template repeat="{{ child in children }}" if="{{cv}}">
                        <template ref="tree_template" bind="{{child}}"></template>
                    </template>
             </core-menu>
            </template>
        </div>
    </template>
    <script>
        Polymer('cmnodes-treeview', {
              data: {},
            toggleChildren: function(e, detail, sender){
                if (e.target.className.indexOf('parent') > -1 && e.target.nextElementSibling) {
               //     var current_display = e.target.nextElementSibling.style.display;
                //    if (current_display === 'none') {
                //        e.target.className = 'parent expanded';
                      //  e.target.nextElementSibling.style.display = 'block';
                //    } else {
                //        e.target.className = 'parent collapsed';
                      //  e.target.nextElementSibling.style.display = 'none';
                //    }
                }
            },
            // Fires when an instance of the element is created
            created: function() {},

            // Fires when the "<polymer-element>" has been fully prepared
              ready: function() {
                if (this.dataset.src) {
                    this.data = JSON.parse(this.dataset.src);
                }
                this.$.main.setAttribute('resolved', '');
                this.$.main.removeAttribute('unresolved');
            },

            // Fires when the elementâ€™s initial set of children and siblings are guaranteed to exist
            domReady: function() {},

            // Fires when the element was inserted into the document
            attached: function() {},

            // Fires when the element was removed from the document
            detached: function() {},

            // Fires when an attribute was added, removed, or updated
            attributeChanged: function(attr, oldVal, newVal) {}
        });
    </script>
</polymer-element>